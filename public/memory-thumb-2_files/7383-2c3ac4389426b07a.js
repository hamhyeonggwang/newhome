"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7383],{3792:(e,t,a)=>{a.d(t,{MT:()=>s,Mf:()=>r,SK:()=>i,k0:()=>o});var n=a(1761),l=a(27062);let r=()=>{let{value:e}=(0,l.fS)("claudeai_saffron_enabled");return e},o=()=>{let{value:e}=(0,l.fS)("claudeai_saffron_themes_enabled");return e},i=()=>{var e;let{account:t}=(0,n.YL)(),a=r();return null!=(e=null==t?void 0:t.settings.enabled_saffron)?e:a},s=()=>{var e;let{account:t}=(0,n.YL)(),a=r();return null!=(e=null==t?void 0:t.settings.enabled_saffron_search)?e:a}},9896:(e,t,a)=>{a.d(t,{F:()=>s});var n=a(27062),l=a(67933),r=a(7620),o=a(70011),i=a(85644);let s=()=>{let e="sticky-model-selector",{value:t}=(0,n.fS)("sticky_model_selector"),{value:a}=(0,n.fS)("model_selector_enabled"),{activeModelOptions:s}=(0,i.A9)(),u=(0,o.Z3)(null),c=(0,l.useQuery)({queryKey:[e],queryFn:()=>{if(!t||!a)return null;let n=localStorage.getItem(e);return n===u?null:n&&s.find(e=>e.model===n)?n:null},initialData:null}),d=(0,r.useCallback)(t=>{t&&localStorage.setItem(e,t),c.refetch()},[c]);return{stickyModelPreference:c.data,setStickyModelPreference:d}}},17423:(e,t,a)=>{a.d(t,{M$:()=>c,O5:()=>i,f$:()=>s,lo:()=>u,n7:()=>d});var n=a(77186),l=a(1761),r=a(71473),o=a(87606);let i=()=>{let{activeOrganization:e}=(0,l.YL)(),t=null==e?void 0:e.uuid;return(0,n.Sk)("/api/organizations/".concat(t,"/list_styles"),{queryKey:[r.ss,{orgUUID:t}]})},s=()=>{let{activeOrganization:e}=(0,l.YL)(),t=null==e?void 0:e.uuid,a=(0,o.useQueryClient)();return(0,n.L2)("/api/organizations/".concat(t,"/styles/create"),"POST",{onSuccess:()=>{a.invalidateQueries({queryKey:[r.ss,{orgUUID:t}]})}})},u=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{activeOrganization:a}=(0,l.YL)(),i=null==a?void 0:a.uuid,s=(0,o.useQueryClient)();return(0,n.L2)("/api/organizations/".concat(i,"/styles/").concat(e,"/edit"),"PUT",{onSuccess:()=>{s.invalidateQueries({queryKey:[r.ss,{orgUUID:i}]})},enabled:!t})},c=e=>{let{activeOrganization:t}=(0,l.YL)(),a=null==t?void 0:t.uuid,i=(0,o.useQueryClient)();return(0,n.L2)("/api/organizations/".concat(a,"/styles/").concat(e,"/delete"),"DELETE",{onSuccess:()=>{i.invalidateQueries({queryKey:[r.ss,{orgUUID:a}]})}})},d=()=>{let{activeOrganization:e}=(0,l.YL)(),t=null==e?void 0:e.uuid;return(0,n.L2)("/api/organizations/".concat(t,"/styles/preview"),"POST")}},23058:(e,t,a)=>{a.d(t,{$:()=>c,U:()=>d});var n=a(54568),l=a(89256),r=a.n(l),o=a(62942),i=a(7620),s=a(3792);let u=i.createContext({ghostModeEnabled:!1,setGhostModeEnabled:r(),temporaryConversationUUID:null,setTemporaryConversationUUID:r()}),c=()=>i.useContext(u),d=e=>{let{children:t}=e,a=(0,o.useRouter)(),l=(0,o.useSearchParams)(),r=(0,s.Mf)(),c="true"===l.get("ghostMode"),[d,f]=(0,i.useState)(c),p=(0,i.useRef)(d),[m,g]=(0,i.useState)(null);(0,i.useEffect)(()=>{p.current=d},[d]);let v=(0,i.useCallback)(e=>{if(f(e),e)a.push("?ghostMode=true");else{g(null);let e=new URLSearchParams(l.toString());e.delete("ghostMode");let t=e.toString();a.push("".concat(window.location.pathname).concat(t?"?".concat(t):""),void 0)}},[a,l]);(0,i.useEffect)(()=>{p.current&&!c&&v(!1)},[v,c]);let h=(0,i.useMemo)(()=>({ghostModeEnabled:!!r&&d,setGhostModeEnabled:v,temporaryConversationUUID:r?m:null,setTemporaryConversationUUID:g}),[d,v,m,g,r]);return(0,n.jsx)(u.Provider,{value:h,children:t})}},23486:(e,t,a)=>{a.d(t,{E:()=>n});let n="general-claude"},32442:(e,t,a)=>{function n(e){let t=e,a="",n=0;for(;t!==a&&n<10;)a=t,t=(t=(t=(t=t.normalize("NFKC")).replace(RegExp("[\\p{Cf}\\p{Co}\\p{Cn}]","gu"),"")).replace(RegExp("[\\p{Cc}]","gu"),e=>"\n"===e||"	"===e||"\r"===e?e:"")).replace(/[\u200B-\u200F]/g,"").replace(/[\u202A-\u202E]/g,"").replace(/[\u2066-\u2069]/g,"").replace(/[\uFEFF]/g,"").replace(/[\uE000-\uF8FF]/g,""),n++;if(n>=10)throw Error("Unicode sanitization reached maximum iterations (".concat(10,") for input: ").concat(e.slice(0,100)));return t}a.d(t,{M:()=>function e(t){if("string"==typeof t)return n(t);if(Array.isArray(t))return t.map(e);if(null!==t&&"object"==typeof t){let a={};for(let[n,l]of Object.entries(t))a[e(n)]=e(l);return a}return t},P:()=>n})},33200:(e,t,a)=>{a.d(t,{N:()=>r});var n=a(27062),l=a(21036);function r(e){let t=(0,l.useLayer)("frontend").get("analysis_tool_experiment_enabled",!1),{value:a}=(0,n.fS)("rely_on_analysis_flag"),{value:r}=(0,n.fS)("analysis_tool_launch_ga");if(a){var o;return{value:null!=(o=null==e?void 0:e.enabled_artifacts_attachments)?o:r,source:"flag"}}return{value:(null==e?void 0:e.enabled_artifacts_attachments)||t,source:"experiment"}}},42685:(e,t,a)=>{a.d(t,{OpusRateLimitModalProvider:()=>s,T:()=>i});var n=a(54568),l=a(7620),r=a(71165);let o=null;function i(){o&&o(!0)}function s(){let[e,t]=(0,l.useState)(!1);return(0,l.useEffect)(()=>(o=t,()=>{o=null}),[]),(0,n.jsx)(r.v,{isOpen:e,onClose:()=>t(!1),limitType:"opus"})}},45727:(e,t,a)=>{a.d(t,{p:()=>i});var n=a(19125),l=a(27062),r=a(17423);let o=(e,t)=>"default"===e.type&&e.key===t||"custom"===e.type&&e.uuid===t,i=()=>{let{value:e}=(0,l.fS)("concise_mode_enabled"),{data:t,isLoading:a}=(0,r.O5)(),i=(null==t?void 0:t.defaultStyles)||[],s=[...i,...((null==t?void 0:t.customStyles)||[]).map(e=>({...e,key:e.key||e.uuid}))],[u,c,d]=(0,n.V)("claude_personalized_style",null);if(a||!(null==s?void 0:s.length))return{personalizedStyleOptions:[],defaultStyle:null,storedStyle:null,setStoredStyle:c,clearStoredStyle:d,conciseModeEnabled:e};let f=i.length?i.find(e=>!0===e.isDefault)||i[0]:null;if(e&&(f=i.find(e=>"Concise"===e.key)||f),!u)return{personalizedStyleOptions:s,defaultStyle:f,storedStyle:u,setStoredStyle:c,clearStoredStyle:d,conciseModeEnabled:e};let p=s.find(e=>o(e,u.styleKey)),m=Date.now()-new Date(u.timestamp).getTime()>432e5;return{personalizedStyleOptions:s,storedStyle:p&&!m?p:null,defaultStyle:f,setStoredStyle:c,clearStoredStyle:d,conciseModeEnabled:e}}},50707:(e,t,a)=>{a.d(t,{M:()=>o});var n=a(54568),l=a(32987),r=a(62971);function o(e){let{className:t,onClick:a,as:o="span"}=e;return(0,n.jsx)(o,{className:(0,l.A)("border-0.5 border-border-400 text-accent-secondary-000 px-1.5 py-px rounded-3xl font-small",a&&"cursor-pointer hover:border-border-300 transition-colors",t),onClick:a,children:(0,n.jsx)(r.A,{defaultMessage:"Upgrade",id:"0h/lPMeYkq"})})}},52909:(e,t,a)=>{a.d(t,{CO:()=>f,M3:()=>u,bG:()=>c,ks:()=>m,pz:()=>s,z_:()=>d});var n=a(77186),l=a(1761),r=a(71473),o=a(87606),i=a(91768);let s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:a}=(0,l.YL)(),r=null==a?void 0:a.uuid,o=p(),s=(0,i.eL)();return(0,n.L2)(()=>"/api/organizations/".concat(r,"/projects/").concat(e,"/syncs"),"POST",{enabled:!!(a&&e),...t,onSuccess:function(){for(var a,n=arguments.length,l=Array(n),r=0;r<n;r++)l[r]=arguments[r];o(e),null==(a=t.onSuccess)||a.call(t,...l)},onError:function(){for(var e,a=arguments.length,n=Array(a),l=0;l<a;l++)n[l]=arguments[l];null==(e=t.onError)||e.call(t,...n);let[r,o]=n;s(r,o)}})},u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:a}=(0,l.YL)(),r=null==a?void 0:a.uuid,o=p();return(0,n.L2)(()=>"/api/organizations/".concat(r,"/projects/").concat(e,"/syncs"),"PUT",{enabled:!!(a&&e),...t,onSuccess:function(){for(var a,n=arguments.length,l=Array(n),r=0;r<n;r++)l[r]=arguments[r];o(e),null==(a=t.onSuccess)||a.call(t,...l)}})},c=e=>{let{activeOrganization:t}=(0,l.YL)(),a=null==t?void 0:t.uuid,o=p();return(0,n.Qv)(t=>"/api/organizations/".concat(a,"/projects/").concat(e,"/syncs/").concat(t),"DELETE",(e,t)=>t?t.filter(t=>t.uuid!==e):t,{queryKey:[r.LV,{orgUuid:a,projectUuid:e}],enabled:!!t,onSuccess:()=>{o(e)}})},d=e=>{let{activeOrganization:t}=(0,l.YL)(),a=null==t?void 0:t.uuid,o=p();return(0,n.Qv)(()=>"/api/organizations/".concat(a,"/projects/").concat(e,"/syncs/delete_many"),"POST",(e,t)=>t?t.filter(t=>!e.sync_source_uuids.includes(t.uuid)):t,{queryKey:[r.LV,{orgUuid:a,projectUuid:e}],enabled:!!t,onSuccess:()=>{o(e)}})},f=function(e,t){let a=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{activeOrganization:s}=(0,l.YL)(),u=null==s?void 0:s.uuid,c=(0,o.useQueryClient)(),d=!!(s&&e&&a),{data:f,isLoading:p}=(0,n.Sk)("/api/organizations/".concat(u,"/projects/").concat(e,"/syncs?calculate_size=").concat(null!=t&&t),{queryKey:[r.LV,{orgUuid:u,projectUuid:e,calculateSize:t}],enabled:d,refetchInterval:e=>{var t;return(null==(t=e.state.data)?void 0:t.some(i.z3))?5e3:3e5},structuralSharing:(t,a)=>{let n=void 0!==t&&t.some(i.z3),l=void 0!==a&&a.some(i.z3);return n&&!l&&c.invalidateQueries({queryKey:[r.qz,{orgUuid:u,projectUuid:e}]}),a}});return{data:f,isLoading:!!d&&p}},p=()=>{let{activeOrganization:e}=(0,l.YL)(),t=null==e?void 0:e.uuid,a=(0,o.useQueryClient)();return e=>{a.invalidateQueries({queryKey:[r.LV,{orgUuid:t,projectUuid:e}]}),a.invalidateQueries({queryKey:[r._G,{orgUuid:t,projectUuid:e}]}),a.invalidateQueries({queryKey:[r.qz,{orgUuid:t,projectUuid:e}]})}},m=e=>{let{data:t}=f(e);return!!(null==t?void 0:t.some(i.z3))}},57383:(e,t,a)=>{a.d(t,{_:()=>M,o:()=>z});var n=a(54568),l=a(66860),r=a(61125),o=a(74530),i=a(9896),s=a(77186),u=a(29585),c=a(7620),d=a(67455),f=a(52909),p=a(1761),m=a(51121),g=a(45727),v=a(42685),h=a(63056),y=a(23486),b=a(23058),x=a(19125),_=a(32442);let w={type:"doc",content:[{type:"paragraph",content:[]}]},S=e=>!!e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||"true"===e.getAttribute("contenteditable")||"textbox"===e.getAttribute("role")),C=e=>{if(!e)return!1;let t=e.tagName;return"BUTTON"===t||"SUMMARY"===t||"SELECT"===t||("INPUT"===t?["button","submit","reset","checkbox","radio"].includes(e.type):["button","checkbox","radio","switch","menuitem","menuitemcheckbox","menuitemradio","option"].includes(e.getAttribute("role")||""))},k=e=>{let t=(0,c.useCallback)(t=>{if(e&&!S(document.activeElement)&&1===t.key.length&&!t.ctrlKey&&!t.altKey&&!t.metaKey){var a;if(!(" "===t.key&&C(document.activeElement)))t.preventDefault(),null==(a=e.getEditor())||a.chain().insertContent(t.key).focus().run()}},[e]);(0,c.useEffect)(()=>(document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)),[t])},j=c.createContext({attachments:[],files:[],transitionFiles:[],syncSourceUuids:[],isAtMaxNumUploads:!1,model:"",prompt:"",tipTapEditorState:{},projectUuid:void 0,beamChatUuid:void 0,isNewBeamChat:!1,isChatSyncing:!1,personalizedStyle:void 0,isProjectSyncing:!1,isNewConversation:!1,isProjectLocked:!1,isSending:!1,setPrompt:()=>void 0,setTipTapEditorState:()=>void 0,setAttachments:()=>void 0,setFiles:()=>void 0,setSyncSourceUuids:()=>void 0,setModel:()=>Promise.resolve(),setProjectUuid:()=>void 0,setBeamChatUuid:()=>void 0,setIsNewBeamChat:()=>void 0,sendMessage:()=>void 0,sendTransparentMessage:()=>void 0,stopSampling:()=>void 0,pendingConversationSettings:{},conversation:void 0,focusInput:()=>void 0,improvePrompt:()=>void 0,isImprovingPrompt:!1,isFocused:!1,setIsFocused:()=>void 0,promptInputRef:{current:null},willRedirectOnSubmit:!1,hasBlockingWarning:!1,setHasBlockingWarning:()=>void 0,setPersonalizedStyle:()=>void 0,isUploadingDriveSync:!1,isUploadingGithubSync:!1,setIsUploadingDriveSync:()=>void 0,setIsUploadingGithubSync:()=>void 0,includeProfilePreferences:!0,setIncludeProfilePreferences:()=>void 0,isUploadingFile:!1,setIsUploadingFile:()=>void 0,validateMaxUploadLimit:()=>!1,onDrop:()=>void 0,onPasteFiles:()=>Promise.resolve(),handleUpload:()=>Promise.resolve(),uploadInputProps:{type:"",accept:"",onChange:()=>void 0,multiple:!1,"aria-label":""},hasAttachments:!1,isModelSelectorOpen:!1,setIsModelSelectorOpen:()=>void 0,setPendingConversationSettings:()=>void 0,isPromptUnsafe:()=>!1,currentCompassTask:void 0,setCurrentCompassTask:()=>void 0}),z=()=>c.useContext(j),M=e=>{var t,a,S,C,z,M,E;let{onSend:P,willRedirectOnSubmit:T,onCreate:A,onStopSampling:U,customFileUploadHandler:L}=e,{ghostModeEnabled:N}=(0,b.$)(),D=(0,c.useRef)(null),F="conversation"in e,{children:O,projectUuid:I,namespace:Y}=e,R=F?e.conversation:void 0,{markMessageSent:Q}=(0,h.B)(),K=(0,c.useCallback)(()=>{F&&U&&U()},[U,F]);k(D.current);let{tipTapEditorState:q,setTipTapEditorText:B,setTipTapEditorJSON:V,isTipTapEditorStateUnsafe:G,attachments:J,setAttachments:W,files:Z,setFiles:X,syncSourceUuids:H,setSyncSourceUuids:$,clear:ee}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2?arguments[2]:void 0,n="".concat(a?"".concat(a,":"):"").concat(e),[l,r,i]=(0,x.V)("".concat(n,":attachment"),[]),[s,u,d]=(0,x.V)("".concat(n,":files"),[]),[f,p,m]=(0,x.V)("".concat(n,":syncSourceUuids"),[]),[g,v,h]=(0,x.V)("".concat(n,":textInput"),t?{type:"doc",content:[{type:"paragraph",content:[{type:"text",text:t}]}]}:w),y=(0,c.useCallback)(()=>!!g.__ant_unsafe,[g]),b=(0,c.useCallback)((e,t)=>{let a=(0,_.P)(e),n={type:"doc",content:[{type:"paragraph",content:[{type:"text",text:a}]}]};return a.length>0&&t&&(n.__ant_unsafe=!0),v(n),a},[v]);return{attachments:l,setAttachments:r,files:s,setFiles:u,syncSourceUuids:f,setSyncSourceUuids:p,tipTapEditorState:g,setTipTapEditorJSON:(0,c.useCallback)(e=>{let t=(0,o.h0)(e);return t.length>0&&y()&&(e.__ant_unsafe=!0),v(e),t},[v,y]),setTipTapEditorText:b,isTipTapEditorStateUnsafe:y,clear:(0,c.useCallback)(()=>{h(),i(),d(),m()},[i,h,d,m])}}(null!=(a=null==R?void 0:R.id)?a:void 0===I?"new-conversation":"".concat(I,":conversation"),"",Y),et=q?(0,o.h0)(q):"",[ea,en]=c.useState(et),el=(0,c.useCallback)(e=>{en(V(e))},[V,en]),er=(0,c.useCallback)(function(e){let{forceUpdateTiptap:t=!0,unsafe:a=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=B(e,a);if(en(n),!0===t){var l;null==(l=D.current)||l.setContent(n)}},[B]),eo=(0,d.NY)(H),ei=(0,d.qJ)(eo),es=(0,s.B7)(eo),eu=J.length+Z.length+H.length>=l.Jn,[ec,ed]=c.useState(!1),[ef,ep]=c.useState(),{stickyModelPreference:em}=(0,i.F)(),eg=null!=(z=null!=(C=null!=(S=null==R?void 0:R.model)?S:ef)?C:em)?z:void 0,[ev,eh]=c.useState(),ey=(0,c.useCallback)(e=>{eh(t=>({...t,...e}))},[]),[eb,ex]=c.useState(I),e_=(0,f.ks)(eb),[ew,eS]=c.useState(y.E),[eC,ek]=c.useState(!1),ej=(0,c.useCallback)(e=>{eS(e),e&&ek(!1)},[]),ez=(0,c.useCallback)(e=>{ek(e),e&&eS(void 0)},[]),[eM,eE]=c.useState(!1),[eP,eT]=c.useState(),[eA,eU]=c.useState(!1),[eL,eN]=c.useState(!1),[eD,eF]=c.useState(!1),{storedStyle:eO,defaultStyle:eI}=(0,g.p)(),[eY,eR]=c.useState(),[eQ,eK]=c.useState(!0),[eq,eB]=c.useState();(0,c.useEffect)(()=>{let e=null!=eO?eO:eI;!eY&&e&&eR(e)},[eO,eI,eY]),(0,c.useEffect)(()=>{I&&eb!==I&&ex(I)},[I,eb]);let eV="setPersonalizedStyleCallback"in e?e.setPersonalizedStyleCallback:null;(0,c.useEffect)(()=>{eT(void 0),eE(!1)},[null==R?void 0:R.id]),(0,c.useEffect)(()=>{null==eV||eV(eY)},[eY,eV]);let eG=(0,c.useCallback)(async()=>{if(D.current&&(""!==ea.trim()||0!==J.length||0!==Z.length||0!==H.length)){T&&eT([...Z]),ee(),en(""),T?D.current.setEditable(!1):D.current.setContent(""),eE(!0);try{Q(),F&&P?(await P({prompt:ea,attachments:J,files:Z,syncSources:es,personalized_style:eY}),eE(!1),eT(void 0)):await A({prompt:ea,attachments:J,files:Z,syncSources:es,model:eg,project_uuid:eb,is_new_beam_chat:ew===y.E?void 0:eC,beam_chat_uuid:ew===y.E?void 0:ew,personalized_style:eY,include_conversation_preferences:eQ,is_temporary:N,...ev})}catch(t){var e;if(t instanceof u.LG&&"opus_messages_rate_limit_exceeded"===t.errorCode)(0,v.T)();else throw t;er(ea),null==(e=D.current)||e.setContent(ea),W(J),X(Z),$(H),D.current.setEditable(!0),eE(!1),eT(void 0)}}},[ev,J,ee,Z,eQ,F,eg,A,P,eY,eb,ea,W,X,er,$,H,es,T,N,Q,eC,ew]),eJ=(0,c.useCallback)(async e=>{if(void 0!==e&&""!==e.trim()&&F){eE(!0);try{P&&(await P({prompt:e,attachments:[],files:[],syncSources:[],personalized_style:eY}),eE(!1))}catch(e){if(e instanceof u.LG&&"opus_messages_rate_limit_exceeded"===e.errorCode)(0,v.T)();else throw e;eE(!1)}}},[F,P,eY]),{streamImprovement:eW,isStreaming:eZ}=function(){let{activeOrganization:e}=(0,p.YL)(),[t,a]=(0,c.useState)(!1),[n,l]=(0,c.useState)(null),r=(0,c.useRef)(null),{addError:o}=(0,m.Y)(),i=(0,c.useCallback)(async(t,n,i,s)=>{r.current&&r.current.abort();let u=new AbortController;r.current=u,a(!0),l(null);let c="/api/organizations/".concat(null==e?void 0:e.uuid,"/prompt/improve/stream");try{var d,f,p;let e=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include",signal:u.signal});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let a=null==(d=e.body)?void 0:d.getReader(),l=new TextDecoder;if(!a)throw Error("No response body");let r="",o="",s=!1;for(;!s;){let e=await a.read();if(e.done){s=!0;break}let t=e.value,u=(r+=l.decode(t,{stream:!0})).split("\n");for(let e of(r=u.pop()||"",u))if(e.startsWith("data: ")){let t=e.slice(6);if("[DONE]"===t)continue;try{let e=JSON.parse(t);switch(e.type){case"content_block_delta":(null==(f=e.delta)?void 0:f.text)&&(o+=e.delta.text,n(e.delta.text));break;case"message_stop":i(e.improved_prompt||o);break;case"error":throw Error((null==(p=e.error)?void 0:p.message)||"Unknown error occurred")}}catch(e){}}else e.startsWith("event: ")&&e.slice(7)}}catch(t){if(t instanceof Error&&"AbortError"===t.name)return;let e=t instanceof Error?t:Error(String(t));l(e),null==s||s(e),o("Failed to improve prompt: "+e.message)}finally{a(!1),r.current===u&&(r.current=null)}},[null==e?void 0:e.uuid,o]);return(0,c.useEffect)(()=>()=>{r.current&&r.current.abort()},[]),{streamImprovement:i,isStreaming:t,error:n}}(),eX=(0,c.useCallback)(async()=>{var e,t,a,n;if(!ea.trim())return;null==(e=D.current)||e.setEditable(!1);let l="",r=!1;try{await eW({conversation_uuid:(null==R?void 0:R.id)||"new-conversation",prompt:ea},e=>{var t,a,n;r||(r=!0,er(""),null==(n=D.current)||n.setContent("")),l+=e,er(l,{forceUpdateTiptap:!1}),null==(t=D.current)||t.setContent(l),null==(a=D.current)||a.scrollToEnd()},e=>{var t;er(e),null==(t=D.current)||t.setContent(e)},e=>{var t;er(ea),null==(t=D.current)||t.setContent(ea)})}catch(e){er(ea),null==(t=D.current)||t.setContent(ea)}finally{null==(a=D.current)||a.setEditable(!0),null==(n=D.current)||n.focus()}},[ea,null==R?void 0:R.id,eW,er]),eH=(0,c.useCallback)(async e=>{if(ep(e),F){eE(!0);try{var t;await A({prompt:ea,attachments:J,files:Z,syncSources:es,model:e,project_uuid:eb,create_mode:null==R||null==(t=R.conversationSettings)?void 0:t.create_mode,...ev})}finally{eE(!1)}}},[ev,J,Z,F,eb,ea,A,es,null==R||null==(t=R.conversationSettings)?void 0:t.create_mode]),e$=(0,c.useCallback)(()=>{var e;return null==(e=D.current)?void 0:e.focus()},[D]),[e0,e1]=c.useState(!1),e2=(0,r.cV)(),[e5,e6,e7,e3,e4,e8,e9,te]=(0,l.Si)({syncSourceCount:H.length,attachments:J,setAttachments:W,numExistingConversationAttachments:null!=(M=null==R?void 0:R.attachmentsSoFar)?M:0,files:Z,setFiles:X,numExistingConversationFiles:null!=(E=null==R?void 0:R.files.length)?E:0,detectSameAttachment:()=>!1,selectedModel:eg,blobFileUploadsEnabled:e2,customFileUploadHandler:L}),tt=J.length+Z.length,ta=H.length,tn=e5||eL||eD,tl=tt>0||ta>0||tn,tr=(0,c.useMemo)(()=>{var t;return{prompt:ea,tipTapEditorState:q,attachments:J,files:e.willRedirectOnSubmit&&eM?null!=eP?eP:[]:Z,syncSourceUuids:H,isAtMaxNumUploads:eu,isUploadingDriveSync:eL,isUploadingGithubSync:eD,model:eg,projectUuid:eb,beamChatUuid:ew,isNewBeamChat:eC,isChatSyncing:ei,personalizedStyle:eY,isProjectSyncing:e_,isNewConversation:void 0===R||0===R.messagesSoFar,isProjectLocked:void 0!==I||void 0!==R,isSending:eM,setPrompt:er,setTipTapEditorState:el,setAttachments:W,setFiles:X,setSyncSourceUuids:$,setModel:eH,setProjectUuid:ex,setBeamChatUuid:ej,setIsNewBeamChat:ez,sendMessage:eG,sendTransparentMessage:eJ,improvePrompt:eX,isImprovingPrompt:eZ,stopSampling:K,conversation:R,focusInput:e$,isFocused:eA,setIsFocused:eU,promptInputRef:D,willRedirectOnSubmit:null!=(t=e.willRedirectOnSubmit)&&t,hasBlockingWarning:e0,setHasBlockingWarning:e1,setPersonalizedStyle:eR,setIsUploadingDriveSync:eN,setIsUploadingGithubSync:eF,includeProfilePreferences:eQ,setIncludeProfilePreferences:eK,pendingConversationSettings:ev,setPendingConversationSettings:ey,isUploadingFile:e5,setIsUploadingFile:e6,validateMaxUploadLimit:e7,onDrop:e3,onPasteFiles:e4,handleUpload:e8,uploadInputProps:te,hasAttachments:tl,isModelSelectorOpen:ec,setIsModelSelectorOpen:ed,isPromptUnsafe:G,currentCompassTask:eq,setCurrentCompassTask:eB}},[J,R,Z,e$,I,e0,eQ,eu,ei,eA,e_,eM,eL,eD,eg,eY,eb,ew,eC,ea,e.willRedirectOnSubmit,eG,eJ,eX,eZ,W,X,eH,ev,ey,ej,ez,er,$,el,K,H,q,eP,e5,e6,e7,e3,e4,e8,te,tl,ec,ed,G,eq,eB]);return(0,n.jsx)(j.Provider,{value:tr,children:O})}},61125:(e,t,a)=>{a.d(t,{F9:()=>M,QC:()=>x,_F:()=>c,cV:()=>E,cb:()=>w,cm:()=>h,eT:()=>j,kd:()=>k});var n=a(1761),l=a(2341),r=a(27062),o=a(33200);let i=[".DS_Store"],s=["jpg","jpeg","png","gif","webp"],u=["image/jpeg","image/png","image/gif","image/webp"],c={"image/jpeg":"jpg","image/png":"png","image/gif":"gif","image/webp":"webp"},d=["bmp","ico","tiff","tif","psd","raw","cr2","nef","orf","sr2","mobi","jp2","jpx","jpm","mj2","svg","svgz","ai","eps","ps","indd","heic","mp4","mov","avi","mkv","wmv","flv","webm","mpeg","mpg","m4v","3gp","ogv","ogg","rm","rmvb","asf","amv","mpe","m1v","m2v","svi","3g2","roq","nsv","f4v","f4p","f4a","f4b","qt","hdmov","divx","div","m2ts","mts","vob","mp3","wav","wma","aac","flac","alac","aiff","ogg","opus","m4a","amr","awb","wmv","ra","rm","mid","midi","mka","ttf","otf","woff","woff2","eot","sfnt","ttc","suit","zip","doc","pptx"],f=["xls","xlsx","xlsb","xlm","xlsm","xlt","xltm","xltx","ods"],p=["txt","py","ipynb","js","jsx","html","css","java","cs","php","c","cc","cpp","cxx","cts","h","hh","hpp","rs","R","Rmd","swift","go","rb","kt","kts","ts","tsx","m","mm","mts","scala","rs","dart","lua","pl","pm","t","sh","bash","zsh","csv","log","ini","cfg","config","json","proto","yaml","yml","toml","lua","sql","bat","md","coffee","tex","latex","gd","gdshader","tres","tscn"],m=["docx","rtf","epub","odt","odp","pdf"],g=["application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/rtf","application/epub+zip","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.presentation","application/pdf"],v=["csv"],h=e=>{let{imagesEnabled:t=!1,outOfContextFilesEnabled:a=!1,wiggleEnabled:n=!1}=e;return[...n?[".pptx",".doc",".docx",".zip"]:[],...m.map(e=>".".concat(e)),...b(),...t?y():[],...a?f.map(e=>".".concat(e)):[]]},y=()=>s.map(e=>".".concat(e)),b=()=>p.map(e=>".".concat(e)),x=e=>e.split(".").pop().toLowerCase(),_=(e,t)=>{let{imagesEnabled:a=!1,blobFileUploadsEnabled:n=!1}=t,l=x(e.name);return!!(!a&&(s.includes(l)||u.includes(e.type)))||(n?d.includes(l):[...d,...f].includes(l))},w=e=>{let t=x(e.name);return s.includes(t)||u.includes(e.type)},S=e=>[...v,...f].includes(x(e.name)),C=e=>!!i.includes(e.name),k=(e,t)=>{let{imagesEnabled:a=!1,blobFileUploadsEnabled:n=!1,rasterizePdfUploadsEnabled:l}=t,r=[],o=[],i=[],s=[],u=[],c=[];return e.filter(e=>!C(e)).forEach(e=>{let t=a&&w(e);_(e,{imagesEnabled:a,blobFileUploadsEnabled:n})?u.push(e):e.size>3e7?c.push(e):n&&S(e)?i.push(e):l&&("pdf"===x(e.name)||"application/pdf"===e.type)?s.push(e):j(e)?r.push(e):t?o.push(e):r.push(e)}),{attachmentUploads:r,imageUploads:o,rasterizedDocumentUploads:s,unsupportedUploads:u,tooLargeUploads:c,outOfContextFileUploads:i}},j=e=>{let t=x(e.name);return m.includes(t)||g.includes(e.type)},z=e=>{let t=new Uint8Array(e);if(t.length>=4){if(239===t[0]&&187===t[1]&&191===t[2])return"utf-8";if(254===t[0]&&255===t[1]||255===t[0]&&254===t[1])return"utf-16";if(0===t[0]&&0===t[1]&&254===t[2]&&255===t[3]||255===t[0]&&254===t[1]&&0===t[2]&&0===t[3])return"utf-32"}let a=!0,n=Math.min(t.length-1,1e3);for(let e=0;e<n;e+=2)if(0===t[e]&&0===t[e+1]||0!==t[e]&&0!==t[e+1]){a=!1;break}if(a)return"utf-16";let l=!0,r=!1;for(let e=0;e<t.length;e++){let a=t[e];if(a>127)if(r=!0,(224&a)==192){if(e+1>=t.length||(192&t[e+1])!=128){l=!1;break}e+=1}else if((240&a)==224){if(e+2>=t.length||(192&t[e+1])!=128||(192&t[e+2])!=128){l=!1;break}e+=2}else if((248&a)==240){if(e+3>=t.length||(192&t[e+1])!=128||(192&t[e+2])!=128||(192&t[e+3])!=128){l=!1;break}e+=3}else{l=!1;break}}if(l&&r)return"utf-8";let o=(e=>{let t={ascii:0,nonAscii:0,cyrillic:0,latin1:0,control:0,total:Math.min(e.length,4e3)};for(let a=0;a<t.total;a++){let n=e[a];n<32?t.control++:n<127?t.ascii++:n>127&&(t.nonAscii++,(n>=192&&n<=255||n>=168&&n<=183)&&t.cyrillic++,(n>=128&&n<=159||n>=160&&n<=255)&&t.latin1++)}return t})(t),i=o.cyrillic/o.total*100,s=o.latin1/o.total*100,u=o.ascii/o.total*100;if(o.nonAscii>0){if(i>.3)return"windows-1251";if(s>o.control/o.total*100)return"windows-1252"}return u>90&&o.control/o.total<.1?"ascii":"utf-8"},M=async e=>{let t=await e.arrayBuffer(),a=z(t);try{return new TextDecoder(a,{fatal:!0}).decode(t)}catch(e){if("utf-8"!==a)return new TextDecoder("utf-8",{fatal:!0}).decode(t)}throw Error("Failed to decode file as plain text")};function E(){var e;let{value:t}=(0,r.fS)("ooc_attachments"),{account:a}=(0,n.YL)(),i=(0,l.B)(),s=null!=(e=null!=i?i:null==a?void 0:a.settings)?e:{},{value:u}=(0,o.N)(s);return!!t&&u}},63056:(e,t,a)=>{a.d(t,{PerformanceMetricsProvider:()=>u,B:()=>c});var n=a(54568),l=a(56320);class r{trackTTI(e){let t=this.tracer.startSpan("page.time_to_interactive");t.setAttributes({"performance.tti.duration_ms":e,"performance.metric_type":"tti"}),t.end()}trackTTFT(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=this.tracer.startSpan("chat.time_to_first_token"),n={"performance.ttft.duration_ms":e,"performance.metric_type":"ttft"};t.model&&(n["chat.model"]=t.model),a.setAttributes(n),a.end()}constructor(){this.tracer=l.u.getTracer("claude-ai-performance","1.0.0")}}let o=new r;var i=a(7620);let s=(0,i.createContext)(null);function u(e){let{children:t}=e,a=(0,i.useRef)(!1),l=(0,i.useRef)(null),r=(0,i.useRef)(!1),u=(0,i.useCallback)(()=>{a.current||(a.current=!0,o.trackTTI(performance.now()))},[]),c=(0,i.useCallback)(()=>{l.current=performance.now(),r.current=!1},[]),d=(0,i.useCallback)(e=>{if(null===l.current||r.current)return;r.current=!0;let t=performance.now()-l.current;o.trackTTFT(t,e),l.current=null},[]),f=(0,i.useMemo)(()=>({markEditorReady:u,markMessageSent:c,markFirstTokenReceived:d}),[u,c,d]);return(0,n.jsx)(s.Provider,{value:f,children:t})}function c(){let e=(0,i.useContext)(s);if(!e)throw Error("usePerformanceMetrics must be used within a PerformanceMetricsProvider");return e}},66860:(e,t,a)=>{a.d(t,{Jn:()=>M,Si:()=>U,fU:()=>O,i1:()=>q,pD:()=>T,vV:()=>Y});var n=a(42977),l=a(54568),r=a(61125),o=a(70011),i=a(85644),s=a(98518),u=a(77186),c=a(1761),d=a(51121),f=a(90510),p=a(29242),m=a(29585),g=a(46612),v=a(71473),h=a(27062),y=a(69055),b=a(7033),x=a(70825),_=a(87606),w=a(7620),S=a(62971),C=a(46760),k=a(81133),j=a(17936);function z(){let e=(0,n._)(["\n  relative\n  grid\n  place-content-center\n  aspect-square\n  rounded-xl\n  cursor-pointer\n  transition\n  [fieldset:not(:disabled)_&]:hover:bg-bg-400\n  [fieldset:disabled_&]:opacity-50\n  [fieldset:disabled_&]:pointer-events-none\n  focus-within:ring\n  inline-flex\n  items-center\n  justify-center\n  relative\n  shrink-0\n  ring-offset-2\n  ring-offset-bg-300\n  ring-accent-main-100\n  focus-visible:outline-none\n  focus-visible:ring-1\n  disabled:pointer-events-none\n  disabled:opacity-50\n  disabled:shadow-none\n  disabled:drop-shadow-none\n  bg-[radial-gradient(ellipse,_var(--tw-gradient-stops))]\n  from-bg-500/10\n  from-50%\n  to-bg-500/30\n  border-0.5\n  border-border-400\n  font-medium\n  font-ui\n  text-text-100/90\n  transition-colors\n  active:bg-bg-500/50\n  hover:text-text-000\n  hover:bg-bg-500/60\n"]);return z=function(){return e},e}let M=20,E=e=>{let t=e.webkitRelativePath;return t&&t.length?t:e.name},P=e=>e.replace(/\0/g,""),T=e=>{e.extracted_content=P(e.extracted_content),e.file_name=P(e.file_name),e.file_type=P(e.file_type)},A=(e,t)=>({file_name:E(e),file_type:e.type,file_size:e.size,extracted_content:t});function U(e){let{syncSourceCount:t,files:a,setFiles:n,numExistingConversationFiles:s,attachments:u,setAttachments:c,numExistingConversationAttachments:f,detectSameAttachment:m,selectedModel:g,blobFileUploadsEnabled:v,customFileUploadHandler:x}=e,{addError:_}=(0,d.Y)(),k=(0,o.Z3)(null);return function(e){let{syncSourceCount:t,onUploadComplete:a,existingAttachments:n,existingFiles:o,numExistingConversationAttachments:s,numExistingConversationFiles:u,selectedModel:c,blobFileUploadsEnabled:d,customFileUploadHandler:f}=e,m=(0,C.A)(),{modelConfig:g}=(0,i.fC)(c),{value:v}=(0,h.fS)("trials_and_tribulations_of_high_school_football"),x=v&&!1,_=g.image_in,[k,j,z,E]=function(e){let{syncSourceCount:t,onUploadComplete:a,existingAttachments:n,existingFiles:o,numExistingConversationFiles:s,selectedModel:u,blobFileUploadsEnabled:c,customFileUploadHandler:d}=e,{modelConfig:f}=(0,i.fC)(u),p=f.image_in,m=q()&&f.pdf_in,{isUploading:g,setIsUploading:v,handleError:h,handleUpload:y}=Y({imagesEnabled:p,blobFileUploadsEnabled:c,onUploadComplete:a,rasterizePdfUploadsEnabled:m,customFileUploadHandler:d}),b=(0,w.useCallback)(e=>{let{newUploads:a=[],numNewPotentialAttachments:i=0,showError:u=!0}=e,{attachmentUploads:d,imageUploads:f,rasterizedDocumentUploads:g,outOfContextFileUploads:v}=(0,r.kd)(a,{imagesEnabled:p,blobFileUploadsEnabled:c,rasterizePdfUploadsEnabled:m});return i+d.length+f.length+g.length+v.length+n.length+o.length+t>M?(u&&h((0,l.jsx)(S.A,{defaultMessage:"You can add at most {count, plural, one {# attachment} other {# attachments}} to a message. Please select fewer attachments.",id:"qxV00r12ob",values:{count:M}})),!1):!(f.length+g.length+o.length+s>100)||(u&&h((0,l.jsx)(S.A,{defaultMessage:"You can add at most {count, plural, one {# file} other {# files}} to a chat. {suggestion}",id:"QyrCxYs5Jy",values:{count:100,suggestion:s<100?(0,l.jsx)(S.A,{defaultMessage:"Please select fewer files.",id:"a6KVizNPLe"}):(0,l.jsx)(S.A,{defaultMessage:"Please consider starting a new chat.",id:"oN0R8lZNm6"})}})),!1)},[p,c,n,o,t,s,h,m]);return[g,v,b,(0,w.useCallback)(async e=>{b({newUploads:e})&&await y(e)},[y,b])]}({syncSourceCount:t,onUploadComplete:a,existingFiles:o,existingAttachments:n,numExistingConversationFiles:u,numExistingConversationAttachments:s,selectedModel:c,blobFileUploadsEnabled:d,customFileUploadHandler:f}),P=function(e){let{handleUpload:t}=e,a=(0,w.useRef)({ready:0,total:0}),n=(0,w.useCallback)(()=>{a.current={ready:0,total:0}},[]),l=(0,w.useCallback)(e=>{a.current.ready+=1,a.current.total===a.current.ready&&t(e)},[t]),r=(0,w.useCallback)((e,t)=>{let n=e.length;for(let o=0;o<n;o++){let n=e[o];n.isFile?(a.current.total+=1,n.file(e=>{t.push(e),l(t)})):n.isDirectory&&n.createReader().readEntries(e=>{r(e,t)})}},[l]);return(0,w.useCallback)(e=>{var t;e.preventDefault(),n();let a=null==(t=e.dataTransfer)?void 0:t.items;if(!a)return;let l=[];for(let e=0;e<(null==a?void 0:a.length);e++){let t=a[e].webkitGetAsEntry();t&&l.push(t)}r(l,[])},[r,n])}({handleUpload:E}),T=(0,w.useCallback)(async e=>{await E(Array.from(e))},[E]),A=(0,w.useCallback)(async e=>{let t=e.target.files;t&&await E(Array.from(t)),e.target.value=""},[E]),U=_?(0,l.jsx)(S.A,{defaultMessage:"Upload docs or images to Claude\\n(Max {maxUploads}, 30mb each)",id:"ialBpH0eLp",values:{maxUploads:M}}):(0,l.jsx)(S.A,{defaultMessage:"Add content ({maxUploads} max, 30mb each)\\nAccepts pdf, txt, csv, etc.",id:"70asB5brJP",values:{maxUploads:M}}),L=(0,w.useCallback)(e=>{A(e)},[A]),N=(0,w.useMemo)(()=>({type:"file",accept:(0,r.cm)({imagesEnabled:_,outOfContextFilesEnabled:d,wiggleEnabled:x}).join(","),onChange:L,multiple:!0,"aria-label":m.formatMessage({defaultMessage:"Upload files",id:"2jjdVzJX0c"})}),[_,d,x,L,m]);return[k,j,z,P,T,E,(0,l.jsx)(p.m,{className:"text-center",tooltipContent:U,children:(0,l.jsxs)(R,{children:[(0,l.jsx)("input",{"data-testid":"file-upload",className:"absolute inset-0 -z-10 overflow-hidden rounded-xl opacity-0",...N}),k?(0,l.jsx)(y.N,{className:"animate-spin",size:18}):(0,l.jsx)(b.x,{size:18,weight:"light"})]})},"upload-tooltip"),N]}({syncSourceCount:t,onUploadComplete:(0,w.useCallback)(async(e,t)=>{m&&e.find(e=>m(e.extracted_content))&&_((0,l.jsx)(S.A,{defaultMessage:"The same attachment was already added earlier. Claude sees the full conversation when replying, so there’s no need to re-upload.",id:"Uo3qvhGn7z"})),c(t=>[...t,...e]),n(e=>[...e,...t])},[m,_,c,n]),existingAttachments:u,existingFiles:a,numExistingConversationAttachments:f,numExistingConversationFiles:s,selectedModel:null!=g?g:k,blobFileUploadsEnabled:v,customFileUploadHandler:x})}let L=async(e,t,a)=>{let n=new Image;if(n.src=URL.createObjectURL(e),await new Promise(e=>{n.onload=e,setTimeout(e,250)}),!n.width||!n.height||"image/png"!==e.type&&n.width<=t&&n.height<=a)return e;let l=n.width/n.height,r=n.width,o=n.height;n.width>t&&(o=(r=t)/l),o>a&&(r=(o=a)*l);let i=document.createElement("canvas");i.style.display="none",document.body.appendChild(i);let s=i.getContext("2d");if(!s||!s.imageSmoothingQuality)return document.body.removeChild(i),e;s.imageSmoothingQuality="high",i.width=r,i.height=o,s.drawImage(n,0,0,r,o);let u=await new Promise(e=>{i.toBlob(t=>e(t),"image/webp",.85)});return(document.body.removeChild(i),u)?new File([u],e.name,{type:"image/webp"}):e},N=()=>{let{value:e}=(0,h.fS)("use_canvas_resize");return(0,w.useCallback)(async t=>e?await L(t,2e3,2e3):t,[e])},D=()=>{let e=K(),t=O();return async(a,n,l)=>{try{return await t(a,n,l)}catch(t){e(t,(0,r.cb)(a)?"image":"file")}}},F=e=>{let t=K(),a=O(),n=(0,u.mn)();return async(l,r,o)=>{let i={};try{i.file=await a(l,r,o)}catch(a){a instanceof m.LG&&"document_too_many_pages"===a.errorCode?i.attachment=await Q(n,l,r,e):t(a,"document")}return i}},O=()=>{let e=(0,u.mn)(),t=(0,_.useQueryClient)();return async(a,n,l)=>{let r=new FormData;r.append("file",a);let o=l?"/api/organizations/".concat(n,"/projects/").concat(l,"/upload"):"/api/".concat(n,"/upload"),i=await e(o,{method:"POST",body:r}),s=await i.json();if(i.ok)return l&&t.invalidateQueries({queryKey:[v.qz,{orgUuid:n,projectUuid:l}]}),s;throw(0,m.a5)(i.status,s,"File upload failed",i.headers)}},I=async(e,t,a,n)=>{let r,o=new FormData;o.append("file",t);try{r=await e("/api/organizations/".concat(a,"/convert_document"),{method:"POST",body:o})}catch(e){return(0,x.Cp)(e),n((0,l.jsx)(S.A,{defaultMessage:"One or more file uploads have failed. Please try again.",id:"FIwcYDeyIC"}))}if(429===r.status)return n((0,l.jsx)(S.A,{defaultMessage:"Too many file upload attempts. Please wait and try again later.",id:"h/6cMHSn1V"}));if(413===r.status)return n((0,l.jsx)(S.A,{defaultMessage:"Uploaded file is too large. Try uploading a smaller part of the document, or copy/pasting an excerpt from the file.",id:"/mCoauj3Ws"}));if(!r.ok)return n((0,l.jsx)(S.A,{defaultMessage:"Text extraction failed for one of the uploaded files. Please try again.",id:"ngYPeW4aWf"}));let i=await r.json();return i&&0!==Object.keys(i).length&&i.extracted_content?(i.file_name=E(t),i):n((0,l.jsx)(S.A,{defaultMessage:"Text extraction failed for one of the uploaded files. Please try again.",id:"ngYPeW4aWf"}))},Y=e=>{var t;let{imagesEnabled:a,blobFileUploadsEnabled:n,rasterizePdfUploadsEnabled:o,onUploadComplete:i,onError:f,projectUuid:p,customFileUploadHandler:m}=e,{activeOrganization:v}=(0,c.YL)(),h=null!=(t=null==v?void 0:v.uuid)?t:"",[y,b]=(0,w.useState)(!1),{addError:x}=(0,d.Y)(),_=(0,w.useCallback)(e=>{b(!1),x(e),f&&f()},[x,f,b]),C=N(),j=D(),z=F(_),M=(0,u.mn)(),E=(0,s.st)(),P=(0,w.useCallback)(async(e,t)=>{if(m){b(!0);try{let t=await m(e);t&&t.length>0&&await i([],t)}catch(e){_(e instanceof Error?e.message:"File upload failed")}finally{b(!1)}return}let{attachmentUploads:s,imageUploads:u,rasterizedDocumentUploads:c,unsupportedUploads:d,tooLargeUploads:f,outOfContextFileUploads:v}=(0,r.kd)(e,{imagesEnabled:a,blobFileUploadsEnabled:n,rasterizePdfUploadsEnabled:o}),y=d.map(e=>(0,r.QC)(e.name));if(y.length>0)return _((0,l.jsx)(S.A,{defaultMessage:"Files of the following {count, plural, one {format is} other {formats are}} not supported: {formats}",id:"9JcWWPAZoB",values:{count:y.length,formats:(0,l.jsx)(k.dT,{type:"conjunction",value:[...new Set(y)]})}}));if(f.length>0)return E.track({event_key:"file_upload_too_large",large_files:f.map(e=>({file_type:e.type,file_size:e.size}))}),_((0,l.jsx)(S.A,{defaultMessage:"You may not upload files larger than 30mb.",id:"Gr/GvEZTX1"}));b(!0);let x=[],w=0,P=(e,a)=>{if(void 0===t)return!0;let n=new Blob([a]).size/g.t2;return!((w+=n)>t)||(_((0,l.jsx)(S.A,{defaultMessage:"Failed to upload file {filename}. Project knowledge exceeds maximum. Remove files to continue.",id:"MbvF6K3PJd",values:{filename:e}})),!1)};for(let e of s){let t=await Q(M,e,h,_);if(!(t&&P(e.name,t.extracted_content)))return;await i([t],[])}for(let e of u){let t=await C(e),a=await j(t,h,p);a&&x.push(a)}for(let e of c){let{file:t,attachment:a}=await z(e,h,p);if(t&&x.push(t),a)if(!P(e.name,a.extracted_content))return;else await i([a],[])}for(let e of v){let t=await j(e,h,p);t&&x.push(t)}await i([],x),b(!1)},[n,M,i,a,_,j,z,h,C,E,o,p,m]);return{isUploading:y,setIsUploading:b,handleError:_,handleUpload:P}},R=f.J.label(z()),Q=async(e,t,a,n)=>{if(!(0,r.eT)(t))try{let e=await (0,r.F9)(t);return A(t,e)}catch(e){}let l=await I(e,t,a,n);if(l)return T(l),l},K=()=>{let{addError:e}=(0,d.Y)();return(0,w.useCallback)((t,a)=>{if(t instanceof m.LG){if("rate_limit_error"===t.type)return void e((0,l.jsxs)("p",{children:[(0,l.jsx)(S.A,{defaultMessage:"You’ve reached your limit for {resourceType} uploads. Please try again later.",id:"M88GeEDB7r",values:{resourceType:a}}),(0,l.jsx)(j.W,{})]}));if("document_password_protected"===t.errorCode)return void e((0,l.jsx)("p",{children:(0,l.jsx)(S.A,{defaultMessage:"The document you uploaded is password protected. Please remove the password and try again.",id:"DHwwKwuaCR"})}))}if(t instanceof m.LG&&"Image is too large"===t.message)return void e((0,l.jsx)("p",{children:(0,l.jsx)(S.A,{defaultMessage:"Image is too large. <link>Learn more</link>",id:"SFbt+MAvby",values:{link:e=>(0,l.jsx)("a",{href:"https://support.anthropic.com/en/articles/9002500-what-kinds-of-images-can-i-upload-to-claude-ai",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-accent-main-100",children:e})}})}));e((0,l.jsx)("p",{children:(0,l.jsx)(S.A,{defaultMessage:"Your {resourceType} upload failed. Please try again.",id:"ymWsV10Pz1",values:{resourceType:a}})}))},[e])},q=()=>{let{value:e}=(0,h.fS)("janus_claude-ai");return e}},67455:(e,t,a)=>{a.d(t,{EF:()=>g,NY:()=>f,Ql:()=>h,VA:()=>v,YO:()=>m,qJ:()=>p});var n=a(77186),l=a(1761),r=a(46612),o=a(71473),i=a(77101),s=a(87606),u=a(7620),c=a(91768),d=a(93049);let f=e=>{let{activeOrganization:t}=(0,l.YL)(),a=null==t?void 0:t.uuid,r=!!(t&&e.length>0),i=(0,u.useMemo)(()=>e.map(e=>"/api/organizations/".concat(a,"/sync/chat/").concat(e)),[a,e]),s=(0,u.useMemo)(()=>({queryKey:e.map(e=>[o.GC,{orgUuid:a,syncSourceUuid:e}]),enabled:r,refetchInterval:e=>!!(e.state.data&&(0,c.z3)(e.state.data))&&5e3,meta:{noToast:!0}}),[r,a,e]);return(0,n._i)(i,s)},p=e=>!!e.some(e=>e.isLoading)||e.some(e=>e.data&&(0,c.z3)(e.data)),m=e=>Math.ceil(f(e).reduce((e,t)=>{var a,n,l;return t.isLoading||!t.data?e:e+(null!=(l=null==(n=t.data)||null==(a=n.status)?void 0:a.current_size_bytes)?l:0)},0)/r.t2),g=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{account:t,activeOrganization:a}=(0,l.YL)(),r=null==t?void 0:t.uuid,u=null==a?void 0:a.uuid,f=(0,s.useQueryClient)(),p=(0,c.eL)();return(0,n.L2)(()=>"/api/organizations/".concat(u,"/sync/chat"),"POST",{enabled:!!a,...e,onSuccess:function(){for(var t,a,n,l,s,c=arguments.length,d=Array(c),p=0;p<c;p++)d[p]=arguments[p];let[m]=d;f.setQueryData([o.GC,{orgUuid:u,syncSourceUuid:m.uuid}],m),m.type===i.v8.GDRIVE&&m.config.uri&&(null==(t=m.status)?void 0:t.extra)&&(null==(a=m.status)?void 0:a.current_size_bytes)&&f.setQueryData([o.QB,{accountUUID:r,orgUUID:u,documentId:m.config.uri}],{uri:"drive:///".concat(m.config.uri),title:null==(l=m.status)?void 0:l.extra,size:null==(s=m.status)?void 0:s.current_size_bytes}),null==(n=e.onSuccess)||n.call(e,...d)},onError:function(){for(var t,a=arguments.length,n=Array(a),l=0;l<a;l++)n[l]=arguments[l];null==(t=e.onError)||t.call(e,...n);let[r,o]=n;p(r,o),o.sync_source_type===i.v8.GDRIVE&&(0,d.D8)(o.sync_source_config.uri)}})},v=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,l.YL)(),a=null==t?void 0:t.uuid,r=(0,s.useQueryClient)();return(0,n.L2)(()=>"/api/organizations/".concat(a,"/sync/chat"),"PUT",{enabled:!!t,...e,onSuccess:function(){for(var t,n=arguments.length,l=Array(n),i=0;i<n;i++)l[i]=arguments[i];let[s]=l;r.setQueryData([o.GC,{orgUuid:a,syncSourceUuid:s.uuid}],s),null==(t=e.onSuccess)||t.call(e,...l)}})},h=()=>{let{activeOrganization:e}=(0,l.YL)(),t=null==e?void 0:e.uuid;return(0,n.L2)(e=>"/api/organizations/".concat(t,"/sync/chat/").concat(e),"DELETE",{enabled:!!e})}},71165:(e,t,a)=>{a.d(t,{S:()=>f,v:()=>d});var n=a(54568),l=a(41417),r=a(76761),o=a(60265),i=a(62942),s=a(25173),u=a(62971),c=a(50707);function d(e){let{isOpen:t,onClose:a,limitType:d="projects",customTitle:f,customDescription:p}=e,m=(0,i.useRouter)(),g=["opus"===d?{defaultMessage:"More Opus usage*",id:"JxRTAGj5OB"}:{defaultMessage:"Access to unlimited Projects to organize chats and documents",id:"uK9wA9v6Z3"},"opus"===d&&{defaultMessage:"Access to unlimited Projects to organize chats and documents",id:"uK9wA9v6Z3"},"projects"===d&&{defaultMessage:"More usage*",id:"Rve6Z5dM8k"},{defaultMessage:"Ability to search the web",id:"dl29r7OlXE"},{defaultMessage:"Extended thinking for complex work",id:"mENE7vJhVQ"},{defaultMessage:"Connect Google Workspace: email, calendar, and docs",id:"WwXweMd3IE"},{defaultMessage:"Ability to use more Claude models",id:"Qpr1Da1f7N"}].filter(Boolean);return(0,n.jsx)(s.bL,{open:t,onOpenChange:a,children:(0,n.jsx)(s.ZL,{children:(0,n.jsx)(s.hJ,{className:"fixed inset-0 bg-always-black/50 backdrop-brightness-75 z-modal flex items-center justify-center data-[state=open]:animate-[fade_250ms_ease-in_forwards] data-[state=closed]:animate-[fade_125ms_ease-out_reverse_forwards]",children:(0,n.jsxs)(s.UC,{className:"z-modal w-full max-w-sm bg-bg-000 rounded-2xl shadow-xl overflow-hidden focus:outline-none data-[state=open]:animate-[zoom_250ms_ease-in_forwards] data-[state=closed]:animate-[zoom_125ms_ease-out_reverse_forwards]",onEscapeKeyDown:e=>{e.preventDefault(),a()},onInteractOutside:e=>{e.preventDefault(),a()},children:[(0,n.jsxs)("div",{className:"flex items-center justify-between px-5 pt-4",children:[(0,n.jsx)(c.M,{}),(0,n.jsx)(s.bm,{asChild:!0,children:(0,n.jsx)(l.$,{variant:"ghost",size:"icon_sm",className:"text-text-400 hover:text-text-200",children:(0,n.jsx)(r.X,{size:20,weight:"regular"})})})]}),(0,n.jsxs)("div",{className:"px-5 pb-4 pt-2",children:[(0,n.jsx)("h2",{className:"text-[24px] leading-tight font-medium mb-2 text-text-000",children:f||("opus"===d?(0,n.jsx)(u.A,{defaultMessage:"More Opus with Pro and Max plans",id:"//ixi/rP/O"}):(0,n.jsx)(u.A,{defaultMessage:"Unlimited projects with Pro and Max plans",id:"RKBJDiWP1p"}))}),(0,n.jsx)("p",{className:"text-base text-text-300 mb-3",children:p||("opus"===d?(0,n.jsx)(u.A,{defaultMessage:"Free plans only get 3 Opus messages per week. Try again after {date}, or upgrade now to get:",id:"IIJcLbtXZK",values:{date:new Date(Date.now()+6048e5).toLocaleDateString("en-US",{month:"long",day:"numeric"})}}):(0,n.jsx)(u.A,{defaultMessage:"Free plans only get access to one Project. Upgrade now to get:",id:"NOiyw9Bber"}))}),(0,n.jsx)("div",{className:"space-y-1.5 mb-6",children:g.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-start gap-2.5",children:[(0,n.jsx)(o.J,{className:"text-text-400 mt-0.5 flex-shrink-0",size:18,weight:"regular"}),(0,n.jsx)("span",{className:"text-sm text-text-200",children:(0,n.jsx)(u.A,{...e})})]},"benefit-".concat(t)))}),("opus"===d||"projects"===d)&&(0,n.jsx)("p",{className:"text-xs text-text-400 mb-4",children:(0,n.jsx)("a",{href:"https://support.anthropic.com/en/articles/11049762-choosing-a-claude-ai-plan",target:"_blank",rel:"noopener noreferrer",className:"text-text-400 underline hover:text-text-300",children:(0,n.jsx)(u.A,{defaultMessage:"*Usage limits apply",id:"HFRZOFWXCf"})})}),(0,n.jsx)(l.$,{variant:"primary",size:"lg",className:"w-full text-base font-medium",onClick:()=>{a(),m.push("/upgrade")},children:(0,n.jsx)(u.A,{defaultMessage:"See plans",id:"vbFKkTYpN+"})})]})]})})})})}let f=d},74530:(e,t,a)=>{function n(e){return"text"===e.type&&e.text?{...e,text:e.text.replace("​","")}:e.content?{...e,content:e.content.map(n)}:e}a.d(t,{DV:()=>n,h0:()=>l});let l=e=>{let t="",a=0,n=function(e){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("doc"===e.type&&e.content)for(let t of e.content)n(t);else if("paragraph"===e.type){if(e.content)for(let t of e.content)n(t);t+="\n"}else if("text"===e.type){let a=e.text;if(e.marks)for(let t of e.marks)"bold"===t.type?a="**".concat(a,"**"):"italic"===t.type?a="*".concat(a,"*"):"underline"===t.type?a="__".concat(a,"__"):"strike"===t.type?a="~~".concat(a,"~~"):"code"===t.type&&(a="`".concat(a,"`"));t+=a}else if("codeBlock"===e.type){let a=e.attrs&&"string"==typeof e.attrs.language?e.attrs.language:"";if(t+="\n```".concat(a,"\n"),e.content)for(let t of e.content)n(t);t+="\n```\n\n"}else if("bulletList"===e.type&&e.content)for(let t of e.content)n(t);else if("orderedList"===e.type&&e.content)for(let t=0;t<e.content.length;t++)n(e.content[t],t+1,!0);else if("listItem"===e.type&&e.content){let o="   ".repeat(a);for(let i of(r?t+="".concat(o).concat(l,". "):t+="".concat(o,"* "),e.content))a+=1,n(i),a-=1}};return n(e),t.replace("​","").trim()}},85644:(e,t,a)=>{a.d(t,{A9:()=>p,Wq:()=>m,fC:()=>c});var n=a(77186),l=a(1761),r=a(71473),o=a(27062),i=a(85544),s=a(75006);let u={image_in:!0,pdf_in:!1},c=e=>{let{activeOrganization:t}=(0,l.YL)(),a=null==t?void 0:t.uuid,{data:o,isLoading:i,isPlaceholderData:s}=(0,n.Sk)("/api/organizations/".concat(a,"/model_configs/").concat(e),{queryKey:[r.yV,a,e],enabled:!!a,staleTime:3e5,meta:{noToast:!0}});return{isLoading:i,modelConfig:!s&&o||u}},d=s.z.array(s.z.object({model:s.z.string(),name:s.z.string(),description:s.z.string().optional(),description_i18n_key:s.z.string().optional(),notice_text:s.z.string().optional(),notice_text_i18n_key:s.z.string().optional(),inactive:s.z.boolean().optional(),overflow:s.z.boolean().optional(),knowledgeCutoff:s.z.string().optional(),slow_kb_warning_threshold:s.z.number().optional(),paprika_modes:s.z.array(i.T4).optional(),capabilities:s.z.object({mm_pdf:s.z.boolean().optional(),mm_images:s.z.boolean().optional(),web_search:s.z.boolean().optional(),gsuite_tools:s.z.boolean().optional(),compass:s.z.boolean().optional()}).optional()})),f=[],p=()=>{let e=(0,o.T9)("claude_ai_models","models",f,d),t=e.filter(e=>!e.inactive),a=t.filter(e=>!e.overflow),n=t.filter(e=>e.overflow);return{allModelOptions:e,activeModelOptions:t,mainModels:a,overflowModels:n}},m=()=>{let{allModelOptions:e}=p();return(t,a)=>{let n=e.find(e=>e.model===t);if(!n)return!1;let l=null==n?void 0:n.capabilities;return!l||!1!==l[a]}}},93049:(e,t,a)=>{a.d(t,{Ac:()=>r,D8:()=>i,bI:()=>o});let n="recentDriveDocs";function l(e){return"object"==typeof e&&null!==e&&"string"==typeof e.uri&&("string"==typeof e.title||void 0===e.title)}function r(e){localStorage.setItem(n,JSON.stringify(e))}function o(){if("undefined"==typeof localStorage)return[];let e=localStorage.getItem(n);if(e){let t=JSON.parse(e);if(t&&Array.isArray(t)&&t.every(l))return t}return[]}function i(e){let t=o();r(t=t.filter(t=>t.uri!==e))}}}]);